util
### WAIT TIME ANALYSIS
# Post warm-up Patients
pwu_pat <- state %>%
group_by(policy, repl, id) %>%
filter(action %in% c('arrived')) %>%
ungroup() %>%
filter(arrived_on > warmup) %>%
select(policy, repl, id)
# Post warm-up wait time (only completed)
pwu_wait_c <- state %>%
group_by(policy, repl, id) %>%
filter(action %in% c('arrived','scheduled', 'rescheduled')) %>%
slice(c(1,n())) %>%
mutate(final_sched = case_when(
is.na(sched_to) == F ~ sched_to,
is.na(resch_to) == F ~ resch_to
)) %>%
mutate(final_sched = min(final_sched, na.rm=T)) %>%
slice(c(1)) %>%
filter(final_sched != Inf) %>%
select(policy, repl, id, period, priority, complexity, surgery, arrived_on, final_sched) %>%
ungroup() %>%
mutate(wait = final_sched - arrived_on)
# Post warm-up wait time (including not completed)
pwu_wait_nc <- state %>%
group_by(policy, repl, id) %>%
filter(action %in% c('arrived','scheduled', 'rescheduled')) %>%
slice(c(1,n())) %>%
mutate(final_sched = case_when(
is.na(sched_to) == F ~ sched_to,
is.na(resch_to) == F ~ resch_to,
TRUE ~ duration+1
)) %>%
mutate(final_sched = min(final_sched, na.rm=T)) %>%
slice(c(1)) %>%
select(policy, repl, id, period, priority, complexity, surgery, arrived_on, final_sched) %>%
ungroup() %>%
mutate(wait = final_sched - arrived_on)
pwu_wait_nc
pwu_wait_nc
pwu_pat
pwu_wait_c %>% right_join(pwu_pat) %>% drop_na()
pwu_wait_c %>% right_join(pwu_pat) %>% drop_na() %>% drop_na()
pwu_wait_c %>% right_join(pwu_pat) %>% drop_na() %>%
group_by(repl, policy) %>%
summarize(mean_w = mean(wait))
pwu_wait_c %>% right_join(pwu_pat) %>% drop_na() %>%
group_by(policy) %>%
summarize(mean_w = mean(wait))
pwu_wait_c %>% right_join(pwu_pat) %>% drop_na() %>%
group_by(policy) %>%
summarize(w_m = mean(wait), w_sd = sd(wait))
pwu_wait_c %>% right_join(pwu_pat) %>% drop_na() %>%
group_by(policy) %>%
summarize(w_m = mean(wait), w_sd = sd(wait)) %>%
mutate(w_moe = 1.96 * w_sd / sqrt(30))
pwu_wait_c %>% right_join(pwu_pat) %>% drop_na() %>%
group_by(policy, surgery) %>%
summarize(w_m = mean(wait), w_sd = sd(wait)) %>%
mutate(w_moe = 1.96 * w_sd / sqrt(30))
### WAITLIST SIZE
#data
periods <- pwu_wait_nc %>% distinct(period) %>% arrange(period) %>% pull(period)
periods
wl_data <- tibble()
for (p in 10) {
print(p)
wait_data <- pwu_wait_nc %>%
group_by(policy, repl, .drop=FALSE) %>%
filter(arrived_on <= p & final_sched > p) %>%
summarize(wt_size = n()) %>%
group_by(policy) %>%
summarize(wt_size_m = mean(wt_size), wt_size_sd = sd(wt_size)) %>%
mutate(period = p)
wl_data <- bind_rows(wl_data, wait_data)
}
range(10)
seq(10)
wl_data <- tibble()
for (p in seq(10)) {
print(p)
wait_data <- pwu_wait_nc %>%
group_by(policy, repl, .drop=FALSE) %>%
filter(arrived_on <= p & final_sched > p) %>%
summarize(wt_size = n()) %>%
group_by(policy) %>%
summarize(wt_size_m = mean(wt_size), wt_size_sd = sd(wt_size)) %>%
mutate(period = p)
wl_data <- bind_rows(wl_data, wait_data)
}
wl_data
wl_data <- tibble()
for (p in seq(10)) {
print(p)
wait_data <- pwu_wait_nc %>%
group_by(policy, repl, .drop=FALSE) %>%
filter(arrived_on <= p & final_sched > p) %>%
summarize(wt_size = n()) %>%
group_by(policy, surgery) %>%
summarize(wt_size_m = mean(wt_size), wt_size_sd = sd(wt_size)) %>%
mutate(period = p)
wl_data <- bind_rows(wl_data, wait_data)
}
wl_data <- tibble()
for (p in seq(10)) {
print(p)
wait_data <- pwu_wait_nc %>%
group_by(policy, repl, surgery, .drop=FALSE) %>%
filter(arrived_on <= p & final_sched > p) %>%
summarize(wt_size = n()) %>%
group_by(policy, surgery) %>%
summarize(wt_size_m = mean(wt_size), wt_size_sd = sd(wt_size)) %>%
mutate(period = p)
wl_data <- bind_rows(wl_data, wait_data)
}
wl_data
wl_data <- tibble()
for (p in periods) {
print(p)
wait_data <- pwu_wait_nc %>%
group_by(policy, repl, .drop=FALSE) %>%
filter(arrived_on <= p & final_sched > p) %>%
summarize(wt_size = n()) %>%
group_by(policy) %>%
summarize(wt_size_m = mean(wt_size), wt_size_sd = sd(wt_size)) %>%
mutate(period = p)
wl_data <- bind_rows(wl_data, wait_data)
}
wl_data
wl_data %>%
filter(period > warmup) %>%
group_by(policy) %>%
summarize(ws_m = mean(wt_size_m), ws_sd = sd(wt_size_m))
wl_data %>%
filter(period > warmup) %>%
group_by(policy) %>%
summarize(ws_m = mean(wt_size_m), ws_sd = sd(wt_size_m)) %>%
mutate(ws_moe = 1.96 * ws_sd / sqrt(30))
wl_data <- tibble()
for (p in periods) {
print(p)
wait_data <- pwu_wait_nc %>%
group_by(policy, repl, surgery, .drop=FALSE) %>%
filter(arrived_on <= p & final_sched > p) %>%
summarize(wt_size = n()) %>%
group_by(policy, surgery) %>%
summarize(wt_size_m = mean(wt_size), wt_size_sd = sd(wt_size)) %>%
mutate(period = p)
wl_data <- bind_rows(wl_data, wait_data)
}
wl_data %>%
filter(period > warmup) %>%
group_by(policy, surgery) %>%
summarize(ws_m = mean(wt_size_m), ws_sd = sd(wt_size_m)) %>%
mutate(ws_moe = 1.96 * ws_sd / sqrt(30))
util
util %>%
filter(period > warmup) %>%
group_by(policy, resource) %>%
summarize(u_m = mean(util), u_sd = sd(util)) %>%
mutate(u_moe = 1.96 * u_sd / sqrt(30))
### WAITLIST SIZE
#data
periods <- pwu_wait_nc %>% distinct(period) %>% arrange(period) %>% pull(period)
wl_data <- tibble()
for (p in periods) {
print(p)
wait_data <- pwu_wait_nc %>%
group_by(policy, repl, .drop=FALSE) %>%
filter(arrived_on <= p & final_sched > p) %>%
summarize(wt_size = n()) %>%
group_by(policy) %>%
summarize(wt_size_m = mean(wt_size), wt_size_sd = sd(wt_size)) %>%
mutate(period = p)
wl_data <- bind_rows(wl_data, wait_data)
}
#graphs
ts_wl_p <- ggplot(wl_data, aes(x=period)) +
geom_line(aes(y=wt_size_m , color=policy)) +
geom_ribbon(aes(ymin=wt_size_m - (2*wt_size_sd / sqrt(30)), ymax=wt_size_m + (2*wt_size_sd / sqrt(30) ), fill=policy), alpha=0.3) +
theme_minimal() +
theme(legend.position="bottom") +
labs(x = 'Week #', y='Size of the Waitlist', title='Waitlist Size over time')
bx_wl_p <- ggplot(wl_data %>% filter(period > warmup)) +
geom_boxplot(aes(y=wt_size_m , fill=policy)) +
theme_minimal() +
theme(legend.position="bottom") +
theme(axis.title.x=element_blank(),
axis.text.x=element_blank(),
axis.ticks.x=element_blank()) +
labs(y='Size of the Waitlist', title='Waitlist Boxplot')
# wait list size
grid.arrange(ts_wl_p, bx_wl_p, ncol=2)
### Reschedules Data
# Usage of Reschedules
resch_data <- state %>%
modify_if(is.character, as.factor) %>%
filter(action == 'rescheduled' & period > warmup) %>%
group_by(repl,policy) %>%
summarize(resch = n()) %>%
ungroup()
resch_data
state %>%
modify_if(is.character, as.factor) %>%
filter(action == 'rescheduled' & period > warmup) %>%
group_by(repl,policy, surgery) %>%
summarize(resch = n()) %>%
ungroup()
state %>%
modify_if(is.character, as.factor) %>%
filter(action == 'rescheduled' & period > warmup) %>%
group_by(period, policy) %>%
summarize(rs = n())
state %>%
modify_if(is.character, as.factor) %>%
filter(action == 'rescheduled' & period > warmup) %>%
group_by(period, policy) %>%
summarize(rs = n()) %>% group_by(policy) %>%
summarize(rs_m = mean(rs), rs_sd = sd(rs))
state %>%
modify_if(is.character, as.factor) %>%
filter(action == 'rescheduled' & period > warmup) %>%
group_by(period, policy) %>%
summarize(rs = n()) %>% group_by(policy) %>%
summarize(rs_m = mean(rs), rs_sd = sd(rs)) %>%
mutate(rs_moe = 1.96 * rs_sd / sqrt(30))
state %>%
modify_if(is.character, as.factor) %>%
filter(action == 'rescheduled' & period > warmup) %>%
group_by(period, policy, surgery) %>%
summarize(rs = n()) %>% group_by(policy) %>%
summarize(rs_m = mean(rs), rs_sd = sd(rs)) %>%
mutate(rs_moe = 1.96 * rs_sd / sqrt(30))
state %>%
modify_if(is.character, as.factor) %>%
filter(action == 'rescheduled' & period > warmup) %>%
group_by(period, policy, surgery) %>%
summarize(rs = n()) %>% group_by(policy, surgery) %>%
summarize(rs_m = mean(rs), rs_sd = sd(rs)) %>%
mutate(rs_moe = 1.96 * rs_sd / sqrt(30))
state %>% filter(period > warmup)
state %>% filter(period > warmup) %>%
group_by(policy, period) %>%
filter(action == 'transitioned')
state %>% filter(period > warmup) %>%
group_by(policy, period) %>%
filter(action == 'transition')
state %>% filter(period > warmup) %>%
group_by(policy, period) %>%
filter(action == 'transition') %>%
count(transition    )
state %>% filter(period > warmup) %>%
group_by(policy, period) %>%
filter(action == 'transition') %>%
count(transition)
state %>% filter(period > warmup) %>%
group_by(policy, period) %>%
filter(action == 'transition') %>%
count(transition) %>% group_by(policy) %>%
summarize(t_m = mean(transition), t_sd = sd(transition)) %>%
mutate(t_moe = 1.96 * t_sd - sqrt(30))
state %>% filter(period > warmup) %>%
group_by(policy, period) %>%
filter(action == 'transition') %>%
count(transition) %>% View()
state %>% filter(period > warmup) %>%
group_by(policy, period) %>%
filter(action == 'transition') %>%
count(transition) %>% group_by(policy) %>%
summarize(t_m = mean(n), t_sd = sd(n)) %>%
mutate(t_moe = 1.96 * t_sd - sqrt(30))
state %>% filter(period > warmup) %>%
group_by(policy, period) %>%
filter(action == 'transition') %>%
count(transition) %>% group_by(policy) %>%
summarize(t_m = mean(n), t_sd = sd(n)) %>%
mutate(t_moe = 1.96 * t_sd / sqrt(30))
state %>% filter(period > warmup) %>%
group_by(policy, period, surgery) %>%
filter(action == 'transition') %>%
count(transition) %>% group_by(policy, surgery) %>%
summarize(t_m = mean(n), t_sd = sd(n)) %>%
mutate(t_moe = 1.96 * t_sd / sqrt(30))
state %>% filter(period > warmup & action == 'reschedule')
state %>% filter(period > warmup & action == 'resch')
state %>% filter(period > warmup & action == 'reschedule')
state
state %>% filter(period > warmup & action == 'rescheduled')
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy) %>%
count(action)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period) %>%
count(action) %>%
1
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period) %>%
count(action)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period) %>%
count(action) %>% group_by(policy) %>%
summarize(mean = mean(n))
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, surgery) %>%
count(action) %>% group_by(policy) %>%
summarize(mean = mean(n))
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, surgery) %>%
count(action) %>% group_by(policy, surgery) %>%
summarize(mean = mean(n))
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy, surgery, .drop=FALSE) %>%
summarize(mean = mean(n))
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, action) %>%
group_by(policy, period, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy, .drop=FALSE) %>%
summarize(mean = mean(n))
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE) %>%
count(action) %>% group_by(policy, .drop=FALSE) %>%
summarize(mean = mean(n))
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy, surgery, .drop=FALSE) %>%
summarize(mean = mean(n))
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE) %>%
count(action) %>% group_by(policy, .drop=FALSE) %>%
summarize(mean = mean(n))
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE) %>%
count(action)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE) %>%
count(action) %>% View()
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE) %>%
count(period)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE) %>%
group_by(policy) %>%
count(period)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE) %>%
group_by(policy)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE) %>%
group_by(policy) %>%
count(period)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE) %>% ungroup() %>%
group_by(policy) %>%
count(period)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, period, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE) %>%
1
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(policy, period, .drop=FALSE)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(period, .drop=FALSE)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(.drop=FALSE)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, .drop=FALSE) %>%
count(action)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, .drop=FALSE) %>%
count(surgery)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, .drop=FALSE) %>%
count(action)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, .drop=FALSE) %>%
count(action) %>% group_by(policy) %>%
summarize(r_m = mean(n), r_sd = mean(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30))
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, .drop=FALSE) %>%
count(action) %>% group_by(policy) %>%
summarize(r_m = mean(n), r_sd = mean(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = rm/2000)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, .drop=FALSE) %>%
count(action) %>% group_by(policy) %>%
summarize(r_m = mean(n), r_sd = mean(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy) %>%
summarize(r_m = mean(n), r_sd = mean(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy, surgery) %>%
summarize(r_m = mean(n), r_sd = mean(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy, surgery) %>%
summarize(r_m = mean(n), r_sd = mean(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy, surgery) %>%
summarize(r_m = mean(n), r_sd = mean(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000, r_sd = r_sd/2000)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, .drop=FALSE) %>%
count(action) %>% group_by(policy) %>%
summarize(r_m = mean(n), r_sd = mean(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000, r_sd = r_sd/2000)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, .drop=FALSE) %>%
count(action) %>% group_by(policy) %>%
summarize(r_m = mean(n), r_sd = mean(n))
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, .drop=FALSE) %>%
count(action) %>% group_by(policy) %>%
summarize(r_m = mean(n), r_sd = sd(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000, r_sd = r_sd/2000)
state %>% filter(period > warmup & action == 'rescheduled') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy, surgery) %>%
summarize(r_m = mean(n), r_sd = sd(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000, r_sd = r_sd/2000)
state %>% filter(period > warmup & action == 'transition') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy, surgery) %>%
summarize(r_m = mean(n), r_sd = sd(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000, r_sd = r_sd/2000)
state %>% filter(period > warmup & action == 'transition') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, surgery, .drop=FALSE) %>%
count(action)
state %>% filter(period > warmup & action == 'transition') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy, surgery) %>%
summarize(r_m = mean(n), r_sd = sd(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000, r_sd = r_sd/2000)
state %>% filter(period > warmup & action == 'transition') %>%
select(repl, policy, action) %>%
group_by(repl, policy, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy) %>%
summarize(r_m = mean(n), r_sd = sd(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000, r_sd = r_sd/2000)
state %>% filter(period > warmup & action == 'transition') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, .drop=FALSE) %>%
count(action) %>% group_by(policy) %>%
summarize(r_m = mean(n), r_sd = sd(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000, r_sd = r_sd/2000)
state %>% filter(period > warmup & action == 'transition') %>%
select(repl, policy, surgery, action) %>%
group_by(repl, policy, surgery, .drop=FALSE) %>%
count(action) %>% group_by(policy, surgery) %>%
summarize(r_m = mean(n), r_sd = sd(n)) %>%
mutate(r_moe = 1.96 * r_sd / sqrt(30) / 2000, r_m = r_m/2000, r_sd = r_sd/2000)
library(tidyverse)
library(readr)
library(gridExtra)
warmup <- 1000
duration <- 3000
wl_data
wl_data %>% group_by(policy) %>%
summarize(mean = mean(wt_size_m), sd = sd(wt_size_m))
wl_data %>% filter(period > warmup) %>% group_by(policy) %>%
summarize(mean = mean(wt_size_m), sd = sd(wt_size_m))

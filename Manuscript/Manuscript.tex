\documentclass{article}
\usepackage[utf8]{inputenc}
\usepackage{geometry}
\usepackage{amsmath}
\geometry{margin=1in}
\setlength\parindent{0pt}


\title{Dynamic Knapsack Problem}
\author{KV}
\date{December 2020}

\begin{document}

\maketitle

\section{Decision Epochs}
Decisions are made at the beginning of each time period (will be weeks)

\section{State Space}
State space is defined by current units available for various PPEs for future periods, amount of units already used for various PPEs, current patient waitlist, expected period demand, and number of patients already scheduled
\[ \vec{s}  = (\vec{ue}, \vec{uu}, \vec{pw}, \vec{pe}, \vec{ps})\]
\begin{itemize}
    \item $\vec{ue} = ue_{tp}$ - Expected unist for period $t$, and PPE $p$
    \item $\vec{uu} = uu_{tp}$ - Used units for period $t$, and PPE $p$
    \item $\vec{pw} = pw_{mdc}$ - Number of patients of complexity $d$, CPU $c$, on a wait list for $m$ periods
    \item $\vec{pe} = pe_{dc}$ - Number of patients of complexity $d$, CPU $c$ expected to arrive this period
    \item $\vec{ps} = ps_{tmdc}$ - Number of patients of complexity $d$, CPU $c$, scheduled to period $t$, who have been on the waitlist for $m$ periods ($m$ of 0 stands for people who have just arrived)
\end{itemize}

\section{Action Sets}

\subsection{Description}
At the beginning of each period, decision maker must reschedule appointments as necessary (if patient complexity increased and too much PPE is being used, or if expected units of PPE have changed negatively). And decision maker must also schedule patients to surgeries
\[ \vec{a} = (\vec{sc}, \vec{rsc}) \]
\begin{itemize}
    \item $\vec{sc} = sc_{tmdc}$ - Number of patients of difficulty $d$, CPU $c$, who have been in wait list for $m$ periods, to schedule in period $t$ ($m$ of 0 stands for people who have just arrived)
	\item $\vec{rsc} = rsc_{tt'mdc}$ - Number of patients of difficulty $d$, CPU $c$, who have been on the waitlist for $m$ periods, to reschedule from period $t$ to period $t'$
\end{itemize}

\subsection{Action Constraints}
\begin{itemize}
    \item Total number of PPE units cannot be exceeded  
    \begin{itemize}
    	\item ($U_{pdc}$ - usage of PPE $p$ per patient difficulty $d$, CPU $c$)
    	\item ($uv_{tp}$ - goal variable, unit violation for period $t$, of PPE $p$ )
    \end{itemize}
        \[ \sum_{mdc}(sc_{tmdc})U_{pdc} <= (ue_{tp} - uu_{tp}) + uv_{tp}\ \quad \forall tp \]
	\item Cannot schedule/reschedule past wait list horizon limit
		\[ sc_{tmdc} = 0 \quad \forall tmdc, \text{where } ((t-1)+m) > T \]
		\[ rsc_{tt'mdc} = 0 \quad \forall tt'mdc, \text{where } ((t'-1)+m) > T \]
	\item Bounds on when reschedules are allowed
		\[ rsc_{tt'mdc} = 0 \quad \forall t \in \{ 2...T \}, t' \in \{ 2...T \}, mdc \]
		\[ rsc_{tt'mdc} = 0 \quad \forall tt'mdc, \text{where } t=t' \]
	
	\item number of people scheduled/rescheduled must be consistent
		\[ \sum_{t'} rsc_{tt'mdc} \le ps_{tmdc} \quad \forall tmdc \]
		\[ \sum_{t} sc_{t0dc} \le pe_{dc} \quad \forall dc \]
		\[ \sum_{t} sc_{tmdc} \le pw_{mdc} \quad \forall m \in \{1...M \}, dc \]
\end{itemize}

\section{Transition Probabilities}

\subsection{Uncertainty Sources}
\begin{enumerate}
    	
	\item Number of patients arriving this period - $pe_{dc}$
		\begin{itemize}
			\item let's assume $pea_{dc}$ - is the random variable that represents the number of patients arrived this period. It follows a poisson distribution.
		\end{itemize}
	
	\item Transition between patient difficulties within the wait list - $pw_{mdc}$
		\begin{itemize}
			\item let's assume $pwt_{mdc}$ is the random variable that represents the number of patients of priority $d$, CPU $c$, that have been waiting for $m$ period, that have moved a more complex category. It follows binary distribution.
		\end{itemize}
		
	\item Transition between patient difficulties within the scheduled list - $ps_{tmdc}$
		\begin{itemize}
			\item let's assume $pst_{tmdc}$ is the random variable that represents the number of patients of priority $d$, CPU $c$, that have been waiting for $m$ period, that have been scheduled into period $t$, that have moved a more complex category. It follows binary distribution.
		\end{itemize}

	\item Amout of expected units of PPE resource for the next time period - $bc_{1dc}$
		\begin{itemize}
			\item let's assume $ued_{md}$ is the random variable that represents the deviation of PPE units from the expectation for the next period only. It follows some uniform distribution.
			\item let's assume $uen_{d}$ is the default value to be used for expected number of PPE units $p$ per period
		\end{itemize}
\end{enumerate}

\subsection{Transition Constraints}
\begin{enumerate}

	\item Transition from $\vec{bc}$ to $\vec{bc'}$ - Expected Units of PPE
		\[ ue'_{1p} = ue_{2p} + ued_{p}\ \quad \forall p \]
		\[ ue'_{m-1,p} = ue_{mp}\ \quad \forall m \in \{3...M\}, p \]
		\[ ue'_{Mp} = uen_{d} \quad \forall p \]
	
	\item Transition from $\vec{uu}$ to $\vec{uu'}$ - Used Units of PPE
		\[ uu'_{t-1,p} = uu	_{tp} + \sum_{mdc} ( sc_{t-1,mdc}U_{pdc} ) - \sum_{t'mdc} (rsc_{tt'mdc} U_{pdc}) + \sum_{tmdc} (rsc_{tt'mdc} U_{pdc})  \quad \forall t \in \{2...T\}, p \]
		\[ uu'_{Tp} = 0 \quad \forall p \]

	\item Transition from $\vec{pe}$ to $\vec{pe'}$ - Expected number of patients for this month
		\[\ pe_{dc} = pea_{dc} \quad \forall dc \]

	\item Transition from $\vec{pw}$ to $\vec{pw'}$ - Flow of patients between difficulties/scheduling/cancelling for waitlist
		\[ pw'_{1dc} = pe_{dc} - \sum_{t} sc_{t0dc} \quad \forall dc \]
		\[ pw'_{m+1, dc} = pw_{mdc} - \sum_{t} sc_{tmdc} + pwt_{m,d-1,c} - pwt_{mdc} \quad \forall m \in \{1...M-2 \}, dc \]
		\[ pw'_{Mdc} = \sum_{M-1}^M pw_{mdc} - \sum_{t,M-1}^{M} sc_{tmdc} + \sum_{M-1}^{M} pwt_{m,d-1,c} - \sum_{M-1}^{M} pwt_{mdc}\quad \forall dc \]

	\item Transition from $\vec{ps}$ to $\vec{ps'}$ - Flow of patients between difficulties/scheduling/cancelling for scheduled appointments
		\[ ps'_{t-1,m+1,dc} = ps_{tmdc} +  \sum_{t} sc_{tmdc} - 
		\sum_{t'mdc} (rsc_{tt'mdc} U_{pdc}) + \sum_{tmdc} (rsc_{tt'mdc} U_{pdc}) \] 
		\[+ pst_{tm,d-1,c} - pst_{tmdc} \quad \forall t \in \{2 ... T\},  m \in \{0... M-2 \}, dc \]
		\[ ps'_{t-1,Mdc} = \sum_{M-1}^M ps_{mdc}  - \sum_{t,M-1}^{M} sc_{tmdc} -
		\sum_{t',M-1,dc}^M (rsc_{tt'mdc} U_{pdc}) + \sum_{t,M-1,dc}^M (rsc_{tt'mdc} U_{pdc}) \]
		\[ + \sum_{M-1}^{M} pst_{tm,d-1,c} - \sum_{M-1}^{M} pst_{tm,d,c}\quad \forall t \in \{2...T \}, dc \]
		\[ ps'_{Tmdc} = 0 \quad \forall mdc \]
\end{enumerate}
    
\section{Costs}
Cost will come from two source:  
\begin{itemize} 
	\item cost of waiting ($cw$) (comes from 2 things)
	\item cost of canceling ($cc$)
	\item goal variable (to eliminate constraint violation, but still allow it if necessary)
\end{itemize}
\[ c(\vec{s}, \vec{a}) = \sum_{mdc} cw_{m} (pw_{mdc}- \sum_{t} sc_{tmdc}) + cc \sum_{tt`mdc} rsc_{tt'mdc} + M (uv_{tp})\]
$cw_{m}$ is computed as follows ($val$ is arbitrary number that describes cost growth):
	\[ cw_{m} = val^m \quad \forall m \]
$cc$ is some arbitrary value

\end{document}
